<!DOCTYPE html>
<html>
  <head>
    <title>Login</title>
    <meta charset="UTF-8">
    
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">

    <link rel="stylesheet" href="css/common.css">

    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
  </head>

  <body>
    <form class="form-centre" role="form" id="login_form" action="/api/session" method="post" autocomplete="on">
      <h2 class="form-heading">Please login</h2>
      <div class="form-group">
        <input type="email" name="email" class="form-control" placeholder="Email" autofocus required>
        <input type="password" name="password" class="form-control" placeholder="Password" required>
        <input type="hidden" name="verificationCode" class="form-control" placeholder="Verification Code">
      </div>
      <input class="btn btn-primary" type="submit" value="Login">
      <p class="form-error" id="login_errors"></p>
    </form>
    <div class="centre">
      <p><a id="a_forgot_password" href="#">Forgot your password?</a></p>
      <button type="button" class="btn btn-default" data-toggle="modal" data-target="#registerModal">
        Register now
      </button>
    </div>
    
    <!-- Modal -->
    <div class="modal fade" id="registerModal">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Register Now</h4>
          </div>
          <div class="modal-body">
            <form class="form-centre" role="form" id="register_form" action="/api/user" method="post" autocomplete="on">
              <div class="form-group"><input type="email" name="email" class="form-control" placeholder="Email" autofocus required></div>
              <div class="form-group"><input type="password" name="password" class="form-control" placeholder="Password" required></div>
              <div class="form-group"><input type="password" name="confPassword" class="form-control" placeholder="Confirm password" required></div>
              <div class="form-group"><input type="text" name="firstName" class="form-control" placeholder="First name" required></div>
              <div class="form-group"><input type="text" name="lastName" class="form-control" placeholder="Last name (optional)"></div>
              <div class="form-group"><input class="btn btn-primary" type="submit" value="Register"></div>
              <p class="form-error" id="register_errors"></p>
            </form>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
    
    <script src="js/utils.js"></script>
    <script>
      // DOCUMENT READY
      $(function() {
        // Bind forms to ajax
        $("#login_form").submit(function(e) {
          e.preventDefault();
          submitAjaxForm($(this), function(data) { window.location.reload(); }, $("#login_errors"));
        });
        
        $("#register_form").submit(function(e) {
          e.preventDefault();
          var form = $(this);
          if (validateUpdate(form)) {
            return
          }
          submitAjaxForm(form, function(data) {
            $('#registerModal').modal('hide');
            $("#login_form input[type='hidden']").attr("type", "text").attr("required", "true");
          }, $("#register_errors"));
        });
        
      }); // End of document ready
    </script>
  </body>
</html>
